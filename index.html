<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©¬æ‹‰æ¾è®­ç»ƒæ—¥è®° V2.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f3f4f6; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .card { transition: all 0.2s; }
        .card:active { transform: scale(0.98); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-24">

    <div class="bg-blue-700 text-white p-4 sticky top-0 z-20 shadow-md">
        <div class="flex justify-between items-center mb-3">
            <h1 class="text-lg font-bold">ğŸƒâ€â™‚ï¸ 26å‘¨æŒ‘æˆ˜</h1>
            <div class="flex space-x-2">
                <button onclick="generateReport()" class="bg-green-500 text-xs px-3 py-1.5 rounded shadow hover:bg-green-600 font-medium">
                    ğŸ“‹ å¤åˆ¶
                </button>
                <button onclick="backupToEmail()" class="bg-gray-100 text-blue-700 text-xs px-3 py-1.5 rounded shadow hover:bg-white font-bold flex items-center">
                    ğŸ“© é‚®ä»¶å¤‡ä»½
                </button>
            </div>
        </div>
        
        <select id="week-selector" onchange="changeWeek()" class="w-full p-2 text-black rounded-lg outline-none font-bold shadow-inner bg-blue-50">
            <option value="1">ç¬¬1å‘¨ï¼šåŸºç¡€ä¸ä¿®å¤ (11/20-11/26)</option>
            <option value="2">ç¬¬2å‘¨ï¼šä¿æŒè¿è´¯æ€§ (11/27-12/03)</option>
            <option value="3">ç¬¬3å‘¨ï¼šä¸“æ³¨å§¿åŠ¿ (12/04-12/10)</option>
            <option value="4">ç¬¬4å‘¨ï¼šå‡é‡ä¼‘æ¯ (12/11-12/17)</option>
        </select>
    </div>

    <div class="px-4 pt-4">
        <div class="flex justify-between text-xs text-gray-500 mb-1">
            <span>æœ¬å‘¨è¿›åº¦</span>
            <span id="progress-text">0/7</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </div>

    <div id="schedule-list" class="p-4 space-y-3">
        </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-end justify-center z-50 backdrop-blur-sm">
        <div class="bg-white w-full rounded-t-2xl p-6 h-3/4 overflow-y-auto animate-slide-up">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-blue-800" id="modal-title">ç¼–è¾‘è®°å½•</h2>
                <button onclick="closeModal()" class="text-gray-400 text-2xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">âœ… å®é™…å®Œæˆæƒ…å†µ</label>
                    <input type="text" id="input-result" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="ä¾‹å¦‚ï¼š5.2å…¬é‡Œï¼Œç”¨æ—¶36åˆ†">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ¦µ èº«ä½“æ„Ÿå— (é‡ç‚¹è®°å½•è†ç›–)</label>
                    <textarea id="input-feeling" rows="3" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="è†ç›–æœ‰æ— ç–¼ç—›ï¼Ÿå“ªå„¿ç´§ï¼Ÿ"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ“‰ ç—›æ„Ÿæ‰“åˆ† (0æ— ç—› - 10å‰§ç—›)</label>
                    <div class="flex space-x-2 overflow-x-auto py-2 no-scrollbar">
                        <script>
                            for(let i=0; i<=10; i++) {
                                document.write(`<div onclick="selectPain(${i})" id="pain-btn-${i}" class="pain-btn flex-shrink-0 w-10 h-10 rounded-full border flex items-center justify-center cursor-pointer font-bold ${i>=3 ? 'border-red-200 text-red-600' : 'border-green-200 text-green-600'}">${i}</div>`);
                            }
                        </script>
                    </div>
                    <input type="hidden" id="input-pain">
                </div>

                <button onclick="saveData()" class="w-full bg-blue-600 active:bg-blue-700 text-white py-3 rounded-xl font-bold text-lg shadow-lg mt-4">ä¿å­˜æ‰“å¡</button>
            </div>
        </div>
    </div>

    <script>
        // ================= æ•°æ®å®šä¹‰åŒºåŸŸ (å‰4å‘¨) =================
// ================= æ•°æ®å®šä¹‰åŒºåŸŸ (é’ˆå¯¹è†ç›–å†…ä¾§ç—›ä¼˜åŒ–ç‰ˆ) =================
        const masterPlan = [
            // ç¬¬1å‘¨ï¼šé€‚åº”è·‘å§¿ä¸æ¿€æ´»å†…ä¾§è‚Œè‚‰
            { week: 1, date: "11/20 (å‘¨å››)", task: "è½»æ¾è·‘ 5å…¬é‡Œ", focus: "è·‘é“è½¨ï¼šåŒè„šåˆ†å¼€çº¦10cmï¼Œå‹¿èµ°çŒ«æ­¥" },
            { week: 1, date: "11/21 (å‘¨äº”)", task: "ä¼‘æ¯ & æ‹‰ä¼¸", focus: "é‡ç‚¹ï¼šè´è¶å¼æ‹‰ä¼¸å†…ä¾§ï¼Œç¦æ»šç—›ç‚¹" },
            { week: 1, date: "11/22 (å‘¨å…­)", task: "é•¿è·ç¦»è·‘ 8å…¬é‡Œ", focus: "è·‘4èµ°1 | è†ç›–å¯¹å‡†è„šå°–ï¼Œé˜²å†…æ‰£" },
            { week: 1, date: "11/23 (å‘¨æ—¥)", task: "å¿«èµ° 45åˆ†é’Ÿ", focus: "ä¿æŒæœ‰æ°§ï¼Œæ³¨æ„è„šæ­¥å®½åº¦" },
            { week: 1, date: "11/24 (å‘¨ä¸€)", task: "ä¼‘æ¯", focus: "å½»åº•æ”¾æ¾ï¼Œå¤šç¡ä¸€ä¼š" },
            { week: 1, date: "11/25 (å‘¨äºŒ)", task: "è½»æ¾è·‘ 5å…¬é‡Œ", focus: "æ ¸å¿ƒæ”¶ç´§ï¼Œè½åœ°è½»ç›ˆ" },
            { week: 1, date: "11/26 (å‘¨ä¸‰)", task: "åŠ›é‡è®­ç»ƒ (å†…ä¾§)", focus: "å¿…åšï¼šé å¢™å¤¹çƒé™è¹² + èšŒå¼å¼€åˆ" },
            
            // ç¬¬2å‘¨ï¼šå·©å›ºè·‘å§¿
            { week: 2, date: "11/27 (å‘¨å››)", task: "è½»æ¾è·‘ 6å…¬é‡Œ", focus: "ç»´æŒåŒè„šå®½åº¦ï¼Œå‘¼å¸å¹³ç¨³" },
            { week: 2, date: "11/28 (å‘¨äº”)", task: "ä¼‘æ¯", focus: "æ‹‰ä¼¸å¤§è…¿åä¾§ä¸å†…ä¾§" },
            { week: 2, date: "11/29 (å‘¨å…­)", task: "é•¿è·ç¦»è·‘ 9å…¬é‡Œ", focus: "è·‘4èµ°1 | å…³æ³¨è†ç›–å†…ä¾§æ„Ÿå—" },
            { week: 2, date: "11/30 (å‘¨æ—¥)", task: "å¿«èµ° 45åˆ†é’Ÿ", focus: "æ›¿ä»£äº¤å‰è®­ç»ƒ" },
            { week: 2, date: "12/01 (å‘¨ä¸€)", task: "ä¼‘æ¯", focus: "æ¢å¤" },
            { week: 2, date: "12/02 (å‘¨äºŒ)", task: "è½»æ¾è·‘ 5å…¬é‡Œ", focus: "æ­¥é¢‘180å·¦å³ï¼Œå°æ­¥å¿«è·‘" },
            { week: 2, date: "12/03 (å‘¨ä¸‰)", task: "åŠ›é‡è®­ç»ƒ", focus: "é å¢™é™è¹²æ—¶é—´å¢åŠ 10ç§’" },
            
            // ç¬¬3å‘¨ï¼šè½»å¾®è¿›é˜¶
            { week: 3, date: "12/04 (å‘¨å››)", task: "è½»æ¾è·‘ 6å…¬é‡Œ", focus: "å…³æ³¨è½åœ°å£°éŸ³ï¼Œè¦è½»" },
            { week: 3, date: "12/05 (å‘¨äº”)", task: "ä¼‘æ¯", focus: "æ‹‰ä¼¸å±ˆé«‹è‚Œ" },
            { week: 3, date: "12/06 (å‘¨å…­)", task: "é•¿è·ç¦»è·‘ 10å…¬é‡Œ", focus: "è·‘4èµ°1 | çªç ´åŒä½æ•°" },
            { week: 3, date: "12/07 (å‘¨æ—¥)", task: "å¿«èµ° 50åˆ†é’Ÿ", focus: "è€åŠ›å»ºè®¾" },
            { week: 3, date: "12/08 (å‘¨ä¸€)", task: "ä¼‘æ¯", focus: "æ¢å¤" },
            { week: 3, date: "12/09 (å‘¨äºŒ)", task: "è½»æ¾è·‘ 6å…¬é‡Œ", focus: "æ”¾æ¾è‚©è†€" },
            { week: 3, date: "12/10 (å‘¨ä¸‰)", task: "åŠ›é‡è®­ç»ƒ", focus: "æ ¸å¿ƒ+è‡€éƒ¨+å†…ä¾§å¤´" },
            
            // ç¬¬4å‘¨ï¼šå‡é‡æ¢å¤
            { week: 4, date: "12/11 (å‘¨å››)", task: "è½»æ¾è·‘ 5å…¬é‡Œ", focus: "éå¸¸è½»æ¾ï¼Œäº«å—è·‘æ­¥" },
            { week: 4, date: "12/12 (å‘¨äº”)", task: "ä¼‘æ¯", focus: "å¤šç¡è§‰" },
            { week: 4, date: "12/13 (å‘¨å…­)", task: "é•¿è·ç¦»è·‘ 8å…¬é‡Œ", focus: "å‡é‡å‘¨ï¼Œè®©èº«ä½“ä¿®å¤" },
            { week: 4, date: "12/14 (å‘¨æ—¥)", task: "å¿«èµ° 30åˆ†é’Ÿ", focus: "è½»æ¾æ´»åŠ¨" },
            { week: 4, date: "12/15 (å‘¨ä¸€)", task: "ä¼‘æ¯", focus: "æ¢å¤" },
            { week: 4, date: "12/16 (å‘¨äºŒ)", task: "è½»æ¾è·‘ 4å…¬é‡Œ", focus: "çŠ¶æ€æ£€æŸ¥" },
            { week: 4, date: "12/17 (å‘¨ä¸‰)", task: "åŠ›é‡è®­ç»ƒ (è½»é‡)", focus: "å‡å°‘ç»„æ•°" },
        ];

        let userPlan = [];
        let currentWeek = 1;
        let currentIndex = null;

        function init() {
            const storedData = JSON.parse(localStorage.getItem('marathonPlan_v2')) || [];
            
            userPlan = masterPlan.map((item, index) => {
                const saved = storedData[index];
                return {
                    ...item,
                    result: saved ? saved.result : "",
                    feeling: saved ? saved.feeling : "",
                    pain: saved ? saved.pain : "",
                    done: saved ? saved.done : false
                };
            });
            render();
        }

        function changeWeek() {
            currentWeek = parseInt(document.getElementById('week-selector').value);
            render();
        }

        function render() {
            const list = document.getElementById('schedule-list');
            list.innerHTML = '';
            const weekTasks = userPlan.filter(item => item.week === currentWeek);
            const doneCount = weekTasks.filter(t => t.done).length;
            
            document.getElementById('progress-text').innerText = `${doneCount}/${weekTasks.length}`;
            document.getElementById('progress-bar').style.width = `${(doneCount/weekTasks.length)*100}%`;

            weekTasks.forEach((item) => {
                const realIndex = userPlan.indexOf(item);
                const statusClass = item.done ? 'bg-green-50 border-green-500 border-l-4' : 'bg-white border-l-4 border-blue-200';
                const icon = item.done ? 'âœ…' : 'â­•ï¸';
                const painBadge = item.pain ? `<span class="ml-2 text-xs px-2 py-0.5 rounded ${item.pain > 2 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">ç—›æ„Ÿ:${item.pain}</span>` : '';

                const html = `
                    <div onclick="openModal(${realIndex})" class="card cursor-pointer rounded-xl p-4 shadow-sm flex justify-between items-start mb-3 ${statusClass}">
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-gray-800">${item.date.split(' ')[0]} <span class="text-sm font-normal text-gray-500">${item.date.split(' ')[1]}</span></span>
                                ${painBadge}
                            </div>
                            <div class="font-bold text-gray-900 mb-1">${item.task}</div>
                            <p class="text-xs text-gray-500 mb-2">ğŸ’¡ ${item.focus}</p>
                            ${item.done ? `<div class="text-sm text-gray-700 mt-2 border-t border-gray-200 pt-2 bg-opacity-50"><span class="font-semibold">ğŸ“</span> ${item.result} <br><span class="font-semibold">â¤ï¸</span> ${item.feeling}</div>` : ''}
                        </div>
                        <div class="ml-3 text-xl mt-1">${icon}</div>
                    </div>
                `;
                list.innerHTML += html;
            });
        }

        function openModal(index) {
            currentIndex = index;
            const item = userPlan[index];
            document.getElementById('modal-title').innerText = item.task;
            document.getElementById('input-result').value = item.result;
            document.getElementById('input-feeling').value = item.feeling;
            selectPain(item.pain || 0);
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function selectPain(level) {
            document.getElementById('input-pain').value = level;
            document.querySelectorAll('.pain-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white', 'ring-2', 'ring-blue-300');
            });
            if(level !== "") {
                const btn = document.getElementById(`pain-btn-${level}`);
                if(btn) btn.classList.add('bg-blue-600', 'text-white', 'ring-2', 'ring-blue-300');
            }
        }

        function saveData() {
            const result = document.getElementById('input-result').value;
            const feeling = document.getElementById('input-feeling').value;
            const pain = document.getElementById('input-pain').value;

            if(!result && !feeling) { alert("è¯·è‡³å°‘å¡«å†™ä¸€ç‚¹å†…å®¹"); return; }

            userPlan[currentIndex].result = result;
            userPlan[currentIndex].feeling = feeling;
            userPlan[currentIndex].pain = pain;
            userPlan[currentIndex].done = true;

            localStorage.setItem('marathonPlan_v2', JSON.stringify(userPlan));
            render();
            closeModal();
        }

        // ğŸ“¤ é‚®ä»¶å¤‡ä»½åŠŸèƒ½ (æ ¸å¿ƒ)
        function backupToEmail() {
            const weekTasks = userPlan.filter(item => item.week === currentWeek && item.done);
            
            if(weekTasks.length === 0) {
                alert("âš ï¸ æœ¬å‘¨è¿˜æ²¡æœ‰æ‰“å¡è®°å½•ï¼Œå…ˆè®°å½•ä¸€æ¡å†å¤‡ä»½å§ï¼");
                return;
            }

            const subject = `ğŸƒâ€â™‚ï¸ è®­ç»ƒæ—¥è®°å¤‡ä»½ï¼šç¬¬ ${currentWeek} å‘¨`;
            let body = `ğŸ“… ç¬¬ ${currentWeek} å‘¨è®­ç»ƒæ€»ç»“\n\n`;
            
            weekTasks.forEach(item => {
                body += `ã€${item.date}ã€‘ ${item.task}\n`;
                body += `âœ… ç»“æœ: ${item.result}\n`;
                body += `â¤ï¸ æ„Ÿå—: ${item.feeling} (ç—›æ„Ÿ: ${item.pain}/10)\n`;
                body += `------------------------------\n`;
            });

            body += `\n(è‡ªåŠ¨ç”Ÿæˆè‡ªé©¬æ‹‰æ¾è®­ç»ƒæ—¥è®° Web App)`;

            // å”¤èµ·é‚®ä»¶ APP
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        // ğŸ“‹ å¤åˆ¶æ±‡æŠ¥åŠŸèƒ½ (ç”¨äºå‘ç»™AI)
        function generateReport() {
            let report = `ğŸƒâ€â™‚ï¸ è®­ç»ƒæ±‡æŠ¥ (ç¬¬${currentWeek}å‘¨)\n\n`;
            const weekTasks = userPlan.filter(item => item.week === currentWeek && item.done);
            
            if(weekTasks.length === 0) {
                alert("æœ¬å‘¨è¿˜æ²¡æœ‰æ‰“å¡å“¦ï¼");
                return;
            }

            weekTasks.forEach(item => {
                report += `ğŸ“… ${item.date}\nâœ… ${item.task}\nğŸ“ ${item.result}\nâ¤ï¸ ${item.feeling} (ç—›æ„Ÿ:${item.pain})\n\n`;
            });
            
            navigator.clipboard.writeText(report).then(() => {
                alert("å·²å¤åˆ¶ï¼å¯ä»¥å»ç²˜è´´äº†ã€‚");
            });
        }

        init();
    </script>
</body>
</html>
