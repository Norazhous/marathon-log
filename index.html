<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©¬æ‹‰æ¾è®­ç»ƒæ—¥è®°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .card {
            transition: all 0.2s;
        }

        .card:active {
            transform: scale(0.98);
        }
    </style>
</head>

<body class="pb-20">

    <div class="bg-blue-600 text-white p-4 sticky top-0 z-10 shadow-md">
        <h1 class="text-xl font-bold">ğŸƒâ€â™‚ï¸ 26å‘¨é©¬æ‹‰æ¾æŒ‘æˆ˜</h1>
        <p class="text-sm opacity-80">ç¬¬ä¸€å‘¨ï¼šå»ºç«‹åŸºç¡€ & ä¿®å¤è†ç›–</p>
    </div>

    <div class="p-4">
        <div class="bg-white rounded-xl p-4 shadow-sm flex justify-between items-center">
            <div>
                <p class="text-gray-500 text-xs">æœ¬å‘¨å®Œæˆåº¦</p>
                <p class="text-2xl font-bold text-blue-600" id="progress-text">0/7</p>
            </div>
            <button onclick="generateReport()"
                class="bg-green-500 hover:bg-green-600 text-white text-sm px-4 py-2 rounded-lg font-medium shadow">
                ğŸ“‹ å¤åˆ¶æ±‡æŠ¥ç»™AI
            </button>
        </div>
    </div>

    <div id="schedule-list" class="px-4 space-y-3">
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-end justify-center z-50">
        <div class="bg-white w-full rounded-t-2xl p-6 animate-slide-up h-3/4 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold" id="modal-title">ç¼–è¾‘è®°å½•</h2>
                <button onclick="closeModal()" class="text-gray-500 text-2xl">&times;</button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">å®é™…å®Œæˆè·ç¦»/æ—¶é—´</label>
                    <input type="text" id="input-result"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                        placeholder="ä¾‹ï¼š5å…¬é‡Œï¼Œ35åˆ†é’Ÿ">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">èº«ä½“æ„Ÿå— (è†ç›–/é«‚èƒ«æŸ)</label>
                    <textarea id="input-feeling" rows="4"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                        placeholder="ä¾‹ï¼šè·‘åˆ°3å…¬é‡Œå·¦è†æœ‰ç‚¹ç´§ï¼Œç—›æ„Ÿ 2/10..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">æ‰“åˆ† (0-10, 10ä¸ºå‰§ç—›)</label>
                    <input type="number" id="input-pain" class="w-full p-3 border border-gray-300 rounded-lg"
                        placeholder="0">
                </div>

                <button onclick="saveData()"
                    class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-lg shadow-lg mt-4">ä¿å­˜è®°å½•</button>
            </div>
        </div>
    </div>

    <script>

        const defaultPlan = [
            { date: "11/20 (å‘¨å››)", task: "è½»æ¾è·‘ 5å…¬é‡Œ", focus: "è½»æ¾è¯´è¯ï¼Œè½åœ°è½»ç›ˆ", result: "", feeling: "", pain: "", done: false },
            { date: "11/21 (å‘¨äº”)", task: "ä¼‘æ¯ & æ»šè½´æ”¾æ¾", focus: "å¤§è…¿å‰ä¾§/è‡€éƒ¨", result: "", feeling: "", pain: "", done: false },
            { date: "11/22 (å‘¨å…­)", task: "é•¿è·ç¦»è·‘ 8å…¬é‡Œ", focus: "è·‘4åˆ†èµ°1åˆ†ï¼Œç—›å³åœ", result: "", feeling: "", pain: "", done: false },
            { date: "11/23 (å‘¨æ—¥)", task: "å¿«èµ° 45åˆ†é’Ÿ", focus: "æ‘†è‡‚å¿«èµ°ï¼Œç¦æ­¢è·‘æ­¥", result: "", feeling: "", pain: "", done: false },
            { date: "11/24 (å‘¨ä¸€)", task: "ä¼‘æ¯", focus: "å½»åº•æ”¾æ¾", result: "", feeling: "", pain: "", done: false },
            { date: "11/25 (å‘¨äºŒ)", task: "è½»æ¾è·‘ 5å…¬é‡Œ", focus: "æ ¸å¿ƒæ”¶ç´§ï¼Œå§¿åŠ¿æŒºæ‹”", result: "", feeling: "", pain: "", done: false },
            { date: "11/26 (å‘¨ä¸‰)", task: "åŠ›é‡è®­ç»ƒ", focus: "èšŒå¼/è‡€æ¡¥/ä¾§æŠ¬è…¿", result: "", feeling: "", pain: "", done: false },
        ];

        let plan = JSON.parse(localStorage.getItem('marathonPlan')) || defaultPlan;
        let currentIndex = null;

        // æ¸²æŸ“åˆ—è¡¨
        function render() {
            const list = document.getElementById('schedule-list');
            list.innerHTML = '';
            let doneCount = 0;

            plan.forEach((item, index) => {
                if (item.done) doneCount++;
                const statusColor = item.done ? 'border-green-500 bg-green-50' : 'border-white bg-white';
                const icon = item.done ? 'âœ…' : 'â­•ï¸';

                const html = `
                    <div onclick="openModal(${index})" class="card cursor-pointer rounded-xl p-4 border-l-4 shadow-sm flex justify-between items-start ${statusColor}">
                        <div class="flex-1">
                            <div class="flex justify-between mb-1">
                                <span class="font-bold text-gray-800">${item.date}</span>
                                <span class="text-xs font-bold px-2 py-1 rounded bg-gray-100 text-gray-600">${item.task}</span>
                            </div>
                            <p class="text-xs text-gray-500 mb-2">ğŸ’¡ ${item.focus}</p>
                            ${item.done ? `<div class="text-sm text-gray-700 mt-2 border-t pt-2"><span class="font-bold">ç»“æœ:</span> ${item.result} <br><span class="font-bold">æ„Ÿå—:</span> ${item.feeling} (ç—›æ„Ÿ:${item.pain})</div>` : ''}
                        </div>
                        <div class="ml-3 text-xl">${icon}</div>
                    </div>
                `;
                list.innerHTML += html;
            });

            document.getElementById('progress-text').innerText = `${doneCount}/${plan.length}`;
        }

        // æ‰“å¼€å¼¹çª—
        function openModal(index) {
            currentIndex = index;
            const item = plan[index];
            document.getElementById('modal-title').innerText = `${item.date} - ${item.task}`;
            document.getElementById('input-result').value = item.result;
            document.getElementById('input-feeling').value = item.feeling;
            document.getElementById('input-pain').value = item.pain;
            document.getElementById('modal').classList.remove('hidden');
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            const result = document.getElementById('input-result').value;
            const feeling = document.getElementById('input-feeling').value;
            const pain = document.getElementById('input-pain').value;

            if (result || feeling) {
                plan[currentIndex].result = result;
                plan[currentIndex].feeling = feeling;
                plan[currentIndex].pain = pain;
                plan[currentIndex].done = true;

                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('marathonPlan', JSON.stringify(plan));
                render();
                closeModal();
            } else {
                alert("è¯·å¡«å†™ä¸€äº›å†…å®¹");
            }
        }

        // ç”Ÿæˆç»™AIçš„æ±‡æŠ¥
        function generateReport() {
            let report = "è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€å‘¨è®­ç»ƒåé¦ˆï¼š\n\n";
            plan.forEach(item => {
                if (item.done) {
                    report += `ğŸ“… ${item.date}: ${item.task}\n`;
                    report += `   - ç»“æœ: ${item.result}\n`;
                    report += `   - æ„Ÿå—: ${item.feeling}\n`;
                    report += `   - ç—›æ„Ÿ: ${item.pain}/10\n\n`;
                }
            });

            navigator.clipboard.writeText(report).then(() => {
                alert("å·²å¤åˆ¶ï¼è¯·å›åˆ°å¯¹è¯æ¡†ç²˜è´´ç»™æˆ‘ã€‚");
            }).catch(err => {
                console.error('æ— æ³•å¤åˆ¶', err);
                alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æˆªå›¾æˆ–å¤åˆ¶ã€‚");
            });
        }

        // åˆå§‹åŒ–
        render();

    </script>
</body>

</html>
